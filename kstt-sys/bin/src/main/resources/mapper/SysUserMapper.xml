<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kstt.sys.mapper.SysUserMapper">

    <resultMap type="SysUser" id="SysUserResult">
        <id property="userId" column="user_id"/>
        <result property="userName" column="user_name"/>
        <result property="userEmail" column="user_email"/>
        <result property="userPassword" column="user_password"/>
        <result property="userRealName" column="user_real_name"/>
        <result property="userAffiliation" column="user_affiliation"/>
        <result property="userDepartment" column="user_department"/>
        <result property="userTitle" column="user_title"/>
        <result property="userPosition" column="user_position"/>
        <result property="userPhone" column="user_phone"/>
        <result property="userAddress" column="user_address"/>
        <result property="userCountry" column="user_country"/>
        <result property="userState" column="user_state"/>
        <result property="userCity" column="user_city"/>
        <result property="userPostalCode" column="user_postal_code"/>
        <result property="userRoleId" column="user_role_id"/>
        <result property="userAvatar" column="user_avatar"/>
        <result property="userStatus" column="user_status"/>
        <result property="userEmailVerified" column="user_email_verified"/>
        <result property="userLastLogin" column="user_last_login"/>
        <result property="userOrcid" column="user_orcid"/>
        <result property="userBiography" column="user_biography"/>
        <result property="userClassification" column="user_classification"/>
        <result property="userKeywords" column="user_keywords"/>
        <result property="userDetail" column="user_detail"/>
        <result property="createBy" column="create_by"/>
        <result property="createTime" column="create_time"/>
        <result property="updateBy" column="update_by"/>
        <result property="updateTime" column="update_time"/>
        <result property="remark" column="remark"/>
        <!-- 关联查询 -->
        <association property="userRole" column="user_role_id"
                     select="com.kstt.sys.mapper.SysRoleMapper.selectRoleByRoleId"/>
    </resultMap>

    <sql id="selectSysUserVo">
        select user_id, user_name, user_email, user_password, user_real_name, 
               user_affiliation, user_department, user_title, user_position, user_phone, user_address,
               user_country, user_state, user_city, user_postal_code,
               user_role_id, user_avatar, user_status, user_email_verified, user_last_login, 
               user_orcid, user_biography, user_classification, user_keywords, user_detail,
               create_by, create_time, update_by, update_time, remark 
        from sys_user
    </sql>

    <select id="selectUserByUserId" parameterType="Long" resultMap="SysUserResult">
        <include refid="selectSysUserVo"/>
        where user_id = #{userId}
    </select>

    <select id="selectUserList" parameterType="SysUser" resultMap="SysUserResult">
        <include refid="selectSysUserVo"/>
        <where>
            <if test="userName != null and userName != ''">
                AND user_name like concat('%', #{userName}, '%')
            </if>
            <if test="userEmail != null and userEmail != ''">
                AND user_email like concat('%', #{userEmail}, '%')
            </if>
            <if test="userRealName != null and userRealName != ''">
                AND user_real_name like concat('%', #{userRealName}, '%')
            </if>
            <if test="userAffiliation != null and userAffiliation != ''">
                AND user_affiliation like concat('%', #{userAffiliation}, '%')
            </if>
            <if test="userDepartment != null and userDepartment != ''">
                AND user_department like concat('%', #{userDepartment}, '%')
            </if>
            <if test="userRoleId != null">
                AND user_role_id = #{userRoleId}
            </if>
            <if test="userStatus != null">
                AND user_status = #{userStatus}
            </if>
        </where>
        order by create_time desc
    </select>

    <insert id="insertSysUser" parameterType="SysUser" useGeneratedKeys="true" keyProperty="userId">
        insert into sys_user
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="userName != null and userName != ''">user_name,</if>
            <if test="userEmail != null and userEmail != ''">user_email,</if>
            <if test="userPassword != null and userPassword != ''">user_password,</if>
            <if test="userRealName != null and userRealName != ''">user_real_name,</if>
            <if test="userAffiliation != null">user_affiliation,</if>
            <if test="userDepartment != null">user_department,</if>
            <if test="userTitle != null">user_title,</if>
            <if test="userPosition != null">user_position,</if>
            <if test="userPhone != null">user_phone,</if>
            <if test="userAddress != null">user_address,</if>
            <if test="userCountry != null">user_country,</if>
            <if test="userState != null">user_state,</if>
            <if test="userCity != null">user_city,</if>
            <if test="userPostalCode != null">user_postal_code,</if>
            <if test="userRoleId != null">user_role_id,</if>
            <if test="userAvatar != null">user_avatar,</if>
            <if test="userStatus != null">user_status,</if>
            <if test="userEmailVerified != null">user_email_verified,</if>
            <if test="userLastLogin != null">user_last_login,</if>
            <if test="userOrcid != null">user_orcid,</if>
            <if test="userBiography != null">user_biography,</if>
            <if test="userClassification != null">user_classification,</if>
            <if test="userKeywords != null">user_keywords,</if>
            <if test="userDetail != null">user_detail,</if>
            <if test="createBy != null">create_by,</if>
            <if test="createTime != null">create_time,</if>
            <if test="updateBy != null">update_by,</if>
            <if test="updateTime != null">update_time,</if>
            <if test="remark != null">remark,</if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="userName != null and userName != ''">#{userName},</if>
            <if test="userEmail != null and userEmail != ''">#{userEmail},</if>
            <if test="userPassword != null and userPassword != ''">#{userPassword},</if>
            <if test="userRealName != null and userRealName != ''">#{userRealName},</if>
            <if test="userAffiliation != null">#{userAffiliation},</if>
            <if test="userDepartment != null">#{userDepartment},</if>
            <if test="userTitle != null">#{userTitle},</if>
            <if test="userPosition != null">#{userPosition},</if>
            <if test="userPhone != null">#{userPhone},</if>
            <if test="userAddress != null">#{userAddress},</if>
            <if test="userCountry != null">#{userCountry},</if>
            <if test="userState != null">#{userState},</if>
            <if test="userCity != null">#{userCity},</if>
            <if test="userPostalCode != null">#{userPostalCode},</if>
            <if test="userRoleId != null">#{userRoleId},</if>
            <if test="userAvatar != null">#{userAvatar},</if>
            <if test="userStatus != null">#{userStatus},</if>
            <if test="userEmailVerified != null">#{userEmailVerified},</if>
            <if test="userLastLogin != null">#{userLastLogin},</if>
            <if test="userOrcid != null">#{userOrcid},</if>
            <if test="userBiography != null">#{userBiography},</if>
            <if test="userClassification != null">#{userClassification},</if>
            <if test="userKeywords != null">#{userKeywords},</if>
            <if test="userDetail != null">#{userDetail},</if>
            <if test="createBy != null">#{createBy},</if>
            <if test="createTime != null">#{createTime},</if>
            <if test="updateBy != null">#{updateBy},</if>
            <if test="updateTime != null">#{updateTime},</if>
            <if test="remark != null">#{remark},</if>
        </trim>
    </insert>

    <update id="updateUser" parameterType="SysUser">
        update sys_user
        <trim prefix="SET" suffixOverrides=",">
            <if test="userName != null and userName != ''">user_name = #{userName},</if>
            <if test="userEmail != null and userEmail != ''">user_email = #{userEmail},</if>
            <if test="userPassword != null and userPassword != ''">user_password = #{userPassword},</if>
            <if test="userRealName != null and userRealName != ''">user_real_name = #{userRealName},</if>
            <if test="userAffiliation != null">user_affiliation = #{userAffiliation},</if>
            <if test="userDepartment != null">user_department = #{userDepartment},</if>
            <if test="userTitle != null">user_title = #{userTitle},</if>
            <if test="userPosition != null">user_position = #{userPosition},</if>
            <if test="userPhone != null">user_phone = #{userPhone},</if>
            <if test="userAddress != null">user_address = #{userAddress},</if>
            <if test="userCountry != null">user_country = #{userCountry},</if>
            <if test="userState != null">user_state = #{userState},</if>
            <if test="userCity != null">user_city = #{userCity},</if>
            <if test="userPostalCode != null">user_postal_code = #{userPostalCode},</if>
            <if test="userRoleId != null">user_role_id = #{userRoleId},</if>
            <if test="userAvatar != null">user_avatar = #{userAvatar},</if>
            <if test="userStatus != null">user_status = #{userStatus},</if>
            <if test="userEmailVerified != null">user_email_verified = #{userEmailVerified},</if>
            <if test="userLastLogin != null">user_last_login = #{userLastLogin},</if>
            <if test="userOrcid != null">user_orcid = #{userOrcid},</if>
            <if test="userBiography != null">user_biography = #{userBiography},</if>
            <if test="userClassification != null">user_classification = #{userClassification},</if>
            <if test="userKeywords != null">user_keywords = #{userKeywords},</if>
            <if test="userDetail != null">user_detail = #{userDetail},</if>
            <if test="updateBy != null">update_by = #{updateBy},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
            <if test="remark != null">remark = #{remark},</if>
        </trim>
        where user_id = #{userId}
    </update>

    <delete id="deleteUserByUserId" parameterType="Long">
        delete from sys_user where user_id = #{userId}
    </delete>

    <delete id="deleteUserByUserIds" parameterType="Long">
        delete from sys_user where user_id in
        <foreach item="userId" collection="userIds" open="(" separator="," close=")">
            #{userId}
        </foreach>
    </delete>

</mapper>